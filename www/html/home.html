<!DOCTYPE html>
    <html>
        <head>
            <title>Weather Forecast</title>
            <link href="home.css" rel="stylesheet" type="text/css">
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
            <script type="text/javascript" src="session.js"></script>
        </head>
        <body>
            <section class="search-form">
                <p>
                    <button class="grid-100 btn" id="history" onclick="history()">History</button>
                    <button class="grid-100 btn" id="logout" onclick="logout()">Logout</button>
                </p>


                <!-- <form method="GET" name="search" role="search"> -->
                <div role="search" name="search" id="search">
                
                <p class="inp-wrap cat-wrap" id = "station_block">
                    <label for="station" class="grid-25">In</label>
                    <select name="search station" id="station" class="grid-80">
                    <option value="KIND" selected>Indianapolis</option>
                    <option value="KLOT">Chicago</option>
                    <option value="KVTX">Los Angeles</option>
                    <option value="KLWX">Washington DC</option>
                    <option value="KFWS">Dallas</option>
                    <option value="KBOX">Boston</option>
                    <option value="KMUX">San Francisco</option>
                    <option value="KOKX">New York</option>
                    <option value="KAMX">Miami</option>
                    <option value="KRAX">Raleigh</option>
                    </select>
                </p>
                <p class="inp-wrap cat-wrap">
                    <label for="station" class="grid-25">In</label>
                    <select name="search station" id="dataset" class="grid-80" onchange="dataChange()">
                    <option value="Nexrad" selected>Nexrad</option>
                    <option value="MERRA">MERRA</option>
                    </select>
                </p>

                <p class="inp-wrap search-wrap">
                    <label for="datetime-field" class="search-label grid-25">At</label>
                    <input type="datetime-local" name="date-time" id="datetime-field" class="grid-75" ></p>
                <p class="inp-wrap submit-wrap">
                    <button id="find" class="grid-100 btn" onclick="sendRequest()">
                    <span class="search-icon-container"><?xml version="1.0" encoding="utf-8"?>
                    <!-- Generated by IcoMoon.io -->
                    <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
                    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="search-icon" width="768" height="768" viewBox="0 0 768 768">
                    <g id="icomoon-ignore">
                    </g>
                    <path d="M304.5 448.5c79.5 0 144-64.5 144-144s-64.5-144-144-144-144 64.5-144 144 64.5 144 144 144zM496.5 448.5l159 159-48 48-159-159v-25.5l-9-9c-36 31.5-84 49.5-135 49.5-115.5 0-208.5-91.5-208.5-207s93-208.5 208.5-208.5 207 93 207 208.5c0 51-18 99-49.5 135l9 9h25.5z"></path>
                    </svg>
                    </span>
                    Find
                    </button>
                </p>
            </div>

                
                <!-- </form> -->
                <div class="scroll">
                    <p id="output"><img id="if1" src="/assets/test.png" alt="HTML5 Icon" width="1020" height="600"></p>
                    <p id="output"><img id="if2" src="" alt="HTML5 Icon" width="1020" height="600"></p>
                    <p id="output"><img id="if3" src="" alt="HTML5 Icon" width="1020" height="600"></p>
                    <p id="output"><img id="if4" src="" alt="HTML5 Icon" width="1020" height="600"></p>
                    <p id="output"><img id="if5" src="" alt="HTML5 Icon" width="1020" height="600"></p>
                </div>
                <div class="loading" id ="loading">Loading&#8230;</div>
            </body>
                <script>
                    function sendRequest(){
                               
                               const station = document.getElementById( "station" ).value;
                               const date_time = document.getElementById( "datetime-field" ).value;
                               
                               const dataset = document.getElementById( "dataset" ).value;
                        
                               document.getElementById("loading").style.display = "block";

                               if(dataset=='Nexrad'){
                                    const url = "/api/s3g/getweather";
                                    const data_my = {station:station,date_time:date_time,session_id:getCookie("session_id")};
                                    $.ajax({
                                                       url: url,
                                                       type: 'post',
                                                       dataType: 'json',
                                                       contentType: 'application/json',
                                                       success: function (data) {
                                                                                console.log(data);
                                                                                document.getElementById("loading").style.display = "none";
                                                                                if(data.status == "success")
                                                                                {
                                                                                    document.getElementById("if1").src="/assets/img/"+data.img_url+".png";
                                                                                }
                                                                                if(data.status == "error")
                                                                                {
                                                                                    alert(data.message);
                                                                                }
                                                                           },
                                                       data: JSON.stringify(data_my)
                                                   });
                               }
                               if(dataset=='MERRA'){
                                    const url = "/api/merra/merradata";
                                    const data_my = {date_time:date_time,session_id:getCookie("session_id")};
                                    $.ajax({
                                                       url: url,
                                                       type: 'post',
                                                       dataType: 'json',
                                                       contentType: 'application/json',
                                                       success: function (data) {
                                                                                console.log(data);
                                                                                document.getElementById("loading").style.display = "none";
                                                                                if(data.status == "success")
                                                                                {
                                                                                    
                                                                                    document.getElementById("if1").src="/assets/img/"+data.img_urls[0];
                                                                                    document.getElementById("if2").src="/assets/img/"+data.img_urls[1];
                                                                                    document.getElementById("if3").src="/assets/img/"+data.img_urls[2];
                                                                                    document.getElementById("if4").src="/assets/img/"+data.img_urls[3];
                                                                                    document.getElementById("if5").src="/assets/img/"+data.img_urls[4];
                                                                                    document.getElementById("if2").style.display = "block";
                                                                                    document.getElementById("if3").style.display = "block";
                                                                                    document.getElementById("if4").style.display = "block";
                                                                                    document.getElementById("if5").style.display = "block";
                                                                                }
                                                                                if(data.status == "error")
                                                                                {
                                                                                    alert(data.message);
                                                                                }
                                                                           },
                                                       data: JSON.stringify(data_my)
                                                   });
                               }
                               
                           }
                    function logout(){
                        sessionCleanup();
                        location.href = "index.html";
                    }
                    function history(){
                        location.href = "/history/index.html";
                    }
                    $(function(){
                        var dtToday = new Date();

                        var month = dtToday.getMonth() + 1;
                        var day = dtToday.getDate();
                        var year = dtToday.getFullYear();
                        var hours = dtToday.getHours();
                        var min = dtToday.getMinutes();

                        if(month < 10)
                            month = '0' + month.toString();
                        if(day < 10)
                            day = '0' + day.toString();
                        if(hours < 10)
                            hours = '0' + hours.toString();
                        if(min < 10)
                            min = '0' + min.toString();

                        var maxDate = year + '-' + month + '-' + day + 'T'+ hours + ':' + min;    
                        $('#datetime-field').attr('max', maxDate);
                    });
                    function dataChange(){
                        const dataset = document.getElementById( "dataset" ).value;

                        if(dataset=='MERRA'){
                            document.getElementById("station_block").style.display = "none";
                            document.getElementById("if1").src="/assets/"+"world_map.png";
                        }
                        if(dataset=='Nexrad'){
                            document.getElementById("station_block").style.display = "block";
                            document.getElementById("if1").src="/assets/"+"test.png";
                            document.getElementById("if2").style.display = "none";
                            document.getElementById("if3").style.display = "none";
                            document.getElementById("if4").style.display = "none";
                            document.getElementById("if5").style.display = "none";
                        }
                    }
                </script>
    </html>
